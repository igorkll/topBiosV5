local a,b,c,d,e,f,g=component,computer,unicode,table,{"/init.lua","/OS.lua"},function()end,debug.traceback;local h,i,j,k,l,m,n,o,p,q,r,s,t=error,tonumber,tostring,assert,b.beep,pcall,load,xpcall,pairs,ipairs,math.floor,math.huge,{}local u,v,w=c.sub,c.len,c.char;local x,y,z=a.list,a.invoke,a.proxy;local A,B,C=b.pullSignal,b.shutdown,b.uptime;local D,E,F,G,H=d.insert,d.concat,d.remove,table.sort,table.unpack;function getCP(I)local J,K,L=0;while 1 do L=nil;for M,N in x(I)do if I==N then local O=i(device[M].width)or nil;if not O then K=M elseif O>J then J=O;K=M;L=1;break end end end;if not L then local M=z(K or"")return M end end end;local P=getCP("eeprom").address;local function Q(R,S)local T,U,a={},1,1;while 1 do if a>#R then break end;local V=R:sub(a,#S+a-1)if not T[U]then T[U]=""end;if V==S then U=U+1;a=a+#S else T[U]=T[U]..R:sub(a,a)a=a+1 end end;if R:sub(#R-(#S-1),#R)==S then D(T,"")end;return T end;_G.split=Q;local function W(X)return Q(y(P,"getData"),"\n")[X]or""end;_G.getDataPart=W;local function Y(X,Z)if W(X)==Z then return end;if Z:find("\n")then error("\\n char")end;local T=Q(y(P,"getData"),"\n")for a=X,1,-1 do if not T[a]then T[a]=""end end;T[X]=Z;y(P,"setData",E(T,"\n"))end;_G.setDataPart=Y;local function _(a0,a1)if not a1 then a1=function()A(0.1)end end;local a2=C()while C()-a2<a0 do if a1()==false then break end end end;local function a3(M,a4)local a5=y(M,"getLabel")return(a5 and a5 ..":"or"")..M:sub(1,3)..":"..a4 end;local function a6(a7)return not m(a7.setLabel,a7.getLabel())end;local function a8(R,a9,aa)R=u(R,1,a9)local ab,ac=a9-v(R),(" "):rep(a9-v(R))if aa==1 then return ac..R elseif aa==2 then R=(" "):rep(ab//2)..R..(" "):rep(ab//2)if#R<a9 then R=R..(" "):rep(a9-v(R))end;return R else return R..ac end end;local function ad(ae)return ae or"Unknown Error"end;local function af(ab)if type(ab)=="function"then return ab()else return ab end end;local function ag()local ah={}for M in x("filesystem")do D(ah,M)end;G(ah,function(ai,aj)for a=1,#ai do if ai:sub(a,a)~=aj:sub(a,a)then return ai:byte(a)<aj:byte(a)end end end)return p(ah)end;local function ak(M)local function al(M)local a7=z(M)if not a7 then return{}end;local am,an={},{}for a,ao in p(e)do if a7.exists(ao)then D(am,ao)D(an,M)end end;local ap="/boot/kernel/"for aq,a4 in p(a7.list(ap)or{})do D(am,ap..a4)D(an,M)end;return am,am,an end;if M then return al(M)else local am,ar,an={},{},{}for aq,M in ag()do local a5=y(M,"getLabel")local ah=al(M)for a,ao in p(ah)do D(am,(a5 and a5 .."-"or"")..M:sub(1,3).."-"..ao)D(ar,ao)D(an,M)end end;return am,ar,an end end;local function as(a7)return a7.getLabel()or"Unnamed"end;local function at(M)local a7=z(M)return a8(as(a7),12).."  "..(a7.spaceTotal()>=1048576 and"HDD"or a7.spaceTotal()>=65536 and"FDD"or"SYS").."  "..(a7.isReadOnly()and"R  "or"R/W").."  "..a8(string.format("%.1f",a7.spaceUsed()/a7.spaceTotal()*100).."%",6,1).."  "..a8(M,7).."…"end;local au,av,aw=getCP("gpu")if au then av=W(2)if not z(av)then av=x("screen")()if av then Y(2,av)end end;if av then aw=y(av,"getKeyboards")[1]au.bind(av)end end;local ax,ay,az;if av then ax,ay=au.getResolution()az=r(au.getDepth())m(y,av,"setPrecise",false)end;local aA=av and(aw or r(device[av].width)~=1)_G.isControl=aA;local function aB(aC,aD,aE)if az==4 then return aD or aC elseif az==1 then return aE and 0xFFFFFF or 0 else return aC end end;local aF,aG=aB(0xE1E1E1,0xFFFFFF,1),aB(0x878787,0x222222)local function aH(aI,aJ)au.setBackground(aI or aF)au.setForeground(aJ or aG)end;local function aK(aI,aJ)aH(aI,aJ)au.fill(1,1,ax,ay," ")end;local function aL()au.setForeground(au.setBackground(au.getForeground()))end;local function aM(aN,aO)local aP=ax//2-v(aN)//2+1;au.set(aP,aO,aN)return aP end;local function aQ(aN,aR,ae)if not av then if ae then error(aN,0)end;return end;if not aA and aR==true then aR=1 end;aK()aM(aN,ay//2)if aR==true then aM("Press Enter Or Touch To Continue",ay//2+1)while true do local aS,aT,aq,aU,aV=A()if aS=="touch"and aV==0 and aT==av then break elseif aS=="key_down"and aU==28 and aT==aw then break end end elseif aR then _(aR)end end;_G.status=aQ;local function aW(a5,aX,aY)local aZ=0;for a,ao in p(aX)do if v(ao)>aZ then aZ=v(ao)end end;local a_={}D(a_,"")for a,ao in p(aX)do D(a_,a8(ao,aZ+4,2))end;local b0,aO,b1,b2=(aY or 1)+1,ay//2-#a_//2,nil,{}if aO<1 then aO=1 end;while 1 do local b3=b0//ay*ay;if b0~=b1 then aK()if b3==0 then aH(aB(aF),aB(0,nil,1))aM(a5,aO)end;aH()for a=1,#a_ do local b4=aO+a-b3;if b4>=1 then if b4>ay then break end;if a==b0 then aL()end;b2[a]=aM(a_[a],b4)if a==b0 then aL()end end end end;local b5={A()}b1=b0;if b5[1]=="key_down"and b5[2]==aw then if b5[4]==28 then break elseif b5[4]==200 then b0=b0-1 elseif b5[4]==208 then b0=b0+1 end elseif b5[1]=="scroll"and b5[2]==av then b0=b0-b5[5]elseif b5[1]=="touch"and b5[2]==av and b5[5]==0 then local b6=b5[4]-aO+b3;if b6>=2 and b6<=#a_ and b5[3]>=b2[b6]and b5[3]<b2[b6]+v(a_[b6])then b0=b6;break end end;if b0<2 then b0=2 end;if b0>#a_ then b0=#a_ end end;return b0-1 end;_G.menu=aW;local function b7(a5,a_,b8,b9,ba,aY)if aY and aY>#a_ then aY=1 end;while 1 do local bb={}for a,ao in p(a_)do D(bb,af(ao))end;if not b9 then D(bb,"Back")end;aY=aW(af(a5),bb,aY)if not b9 then F(bb,#bb)end;if b8[aY]then local bc,ae=m(b8[aY])f()if not bc then aQ(ad(ae),true)end;if ba then return aY end else break end end end;_G.menuPro=b7;local function bd(aN,be)local am,bf,bg="",ay//2,0;local function bh()aK()local am=am;if be then am=("*"):rep(v(am))end;local bi=aN..": "..am.."_"aM(bi,bf)end;while 1 do bh()local aS,aT,V,aU=A()if aS=="key_down"and aT==aw then if aU==28 then if not be and am~=t[1]and am~=""then D(t,1,am)end;return am elseif aU==200 or aU==208 then am=""if aU==200 then if bg<#t then bg=bg+1 end else if bg>0 then bg=bg-1 end end;am=t[bg]or""bh()elseif aU==14 then if v(am)>0 then bg=0;am=u(am,1,v(am)-1)bh()end elseif V==3 then return nil elseif V~=0 then bg=0;am=am..w(V)bh()end elseif aS=="clipboard"and aT==aw then bg=0;am=am..V;if u(V,v(V),v(V))=="\n"then local bj=u(am,1,v(am)-1)if not be and t[1]~=bj and t[1]~=""then D(t,1,bj)end;return bj end elseif aS=="touch"and aT==av then if#am==0 then return nil end end end end;_G.input=bd;local function bk(a5,bl,aI)if aI then local bm=aW(a5,{"No","Yes","Back"})if bm==3 then return nil else return bm==2 end else if bl then return aW(a5,{"No","Yes"})==2 else return aW(a5,{"No","No","Yes","No"})==3 end end end;_G.yesno=bk;local function bn(M,a4)local bc,bm=m(y,M,"exists",a4)return bc and bm and not y(M,"isDirectory",a4)end;local function bo(bp,bq)aQ("Boot From: "..a3(bp,bq),1)local br=getFile(z(bp),bq)function b.getBootAddress()return bp end;function b.getBootScreen()return av end;function b.getBootGpu()if av then return au.address end;return nil end;function b.getBootFile()return bq end;function b.setBootAddress(M)Y(1,M or"")if M==""then Y(3,"")return end;local bs;for a,ao in p(e)do if y(M,"exists",ao)then Y(3,ao)bs=1;break end end;if not bs then Y(3,"")end end;function b.setBootScreen(M)Y(2,M or"")end;function b.setBootFile(a4)Y(3,a4 or"")end;function b.shutdown(bt)if bt=="fast"then Y(4,bp..";"..bq)B(1)else B(bt)end end;if bq=="/OS.lua"then z(P).getData=function()return bp end end;l(1000,0.2)local bc,ae=o(k(n(br,"=init")),g)if not bc then f=function()error(ae,0)end;f()end;B()end;_G.bootTo=bo;local function bu(R,bv)local aU,ae=n(R)if not aU then aQ(ad(ae),true)return nil,ae end;local dat={m(aU)}if not dat[1]then aQ(ad(dat[2]),true)end;if bv then aQ(ad(dat[2]),true)end;return H(dat)end;local function bw()local a_,b8={},{}for aq,M in ag()do local a7,aY=z(M),nil;local function bx()return(W(1)==M and"> "or"  ")..at(M).."  "end;D(a_,bx)D(b8,function()::by::local a_={}local b8={}local bz=a7.list("/boot/kernel")or{}if a7.exists("/init.lua")or a7.exists("/OS.lua")or#bz>0 then D(a_,"Set As Bootable")D(a_,"Fastboot")for a=1,2 do D(b8,function()local a_={}local b8={}local function bA(a4)D(b8,function()if a==1 then aQ("Seting As Bootable")Y(1,a7.address)Y(3,a4)else bo(a7.address,a4)end end)end;if a==1 then D(a_,"any")bA("any")end;for a,ao in p(e)do if a7.exists(ao)then D(a_,ao)bA(a_[#a_])end end;for aq,a4 in p(bz)do D(a_,"/boot/kernel/"..a4)bA(a_[#a_])end;b7("Select Boot File",a_,b8)end)end end;if not a7.isReadOnly()then D(a_,"Format")D(b8,function()if bk("Format?")then for aq,a4 in ipairs(a7.list("/"))do if a4~=".efi"then a7.remove(a4)end end;if M==W(1)then Y(1,"")Y(3,"")end end end)end;if not a6(a7)then if aw then D(a_,"Change Label")D(b8,function()local bB=bd("Label")if bB then a7.setLabel(bB)end end)end;D(a_,"Erase Label")D(b8,function()a7.setLabel(nil)end)end;local bC=M;local bD=0;for aq,M in ag()do local bE=z(M)if not bE.isReadOnly()and M~=bC and bE.spaceTotal()>=a7.spaceUsed()then bD=bD+1 end end;if bD>0 then D(a_,"Move Data")D(b8,function()local function bF(M)local a5=z(M).getLabel()if a5==""then a5=nil end;return(a5 and a5 .."-"or"")..M:sub(1,3)end;local a_={}local b8={}for aq,M in ag()do local bE=z(M)if not bE.isReadOnly()and M~=bC and bE.spaceTotal()>=a7.spaceUsed()then local function bx()return at(M)end;D(a_,bx)D(b8,function()local bG=bk("Format Target Drive?",nil,1)if bG==nil then return end;if aW("From: "..bF(bC)..", To: "..bF(M)..", Format: "..j(bG),{"Confirm","Cancel"})==1 then if bG then for aq,a4 in ipairs(bE.list("/"))do if a4~=".efi"then bE.remove(a4)end end end;local function bH(bI,bJ,ap)for aq,a4 in p(bI.list(ap))do local bK=ap..a4;if bI.isDirectory(bK)then bJ.makeDirectory(bK)bH(bI,bJ,bK)else local bj=getFile(bI,bK)local a4=bJ.open(bK,"wb")bJ.write(a4,bj)bJ.close(a4)end end end;aQ("Moving Files")bH(a7,bE,"/")end end)end end;b7("Select Target Drive, To Clone: "..bF(bC),a_,b8)end)end;aY=b7(function()return(a7.getLabel()or"Unnamed").." ("..M..")"end,a_,b8,nil,1,aY)if aY then goto by end end)end;b7("Disk Menager",a_,b8)end;function internetBoot(bL)bL=bL or bd("Url")if not bL then return end;return bu(k(getInternetFile(bL)))end;local function bM()local dat,bN,a_,bO=k(getInternetFile("https://raw.githubusercontent.com/igorkll/webMarket3/main/list.txt")),{},{},Q(dat,"\n")for a,ao in p(bO)do local bP=Q(ao,";")D(a_,bP[2])D(bN,function()internetBoot(bP[1])end)end;b7("Select Os To Install",a_,bN)end;local function bQ()while 1 do local bB=bd("Lua Code Or EFI Command")if not bB then break end;if bB=="reset"then aQ("Resetting")eeprom_setData("")B(1)elseif bB=="clearboot"then aQ("Clearing")Y(1,"")Y(3,"")else bu(bB,1)end end end;local function bR()b7("Advanced Functions",{function()return"Enable Multi Booting"..(W(1)=="any"and" √"or"")end},{function()aQ("Enabling Multi Booting")Y(1,"any")end})end;local function bS()local bT,b8={"Disk Manager","Advanced Functions","Shutdown","Reboot"},{bw,bR,B,function()B(1)end}if internet then local bU=2;D(bT,bU,"Install Operating System")D(b8,bU,bM)bU=bU+1;if aw then D(bT,bU,"Internet Boot")D(b8,bU,internetBoot)bU=bU+1 end end;if aw then D(bT,2,"Lua Interpreter/Command Shell")D(b8,2,bQ)end;b7("Smart EFI",bT,b8)end::bV::if aA and W(4)==""then if aw then aQ("Press Alt To Open The Efi Menu")else aQ("Tap On The Screen To Open The Efi Menu")end;_(1,function()local b5={A(0.1)}if b5[1]=="key_down"and b5[2]==aw then if b5[4]==56 then bS()elseif b5[4]==28 then return false end elseif not aw and b5[1]=="touch"and b5[2]==av then if b5[5]==0 then bS()else return false end end end)end;local bW,bX=H(Q(W(4),";"))local bY=W(4)~=""Y(4,"")::bZ::local bp,bq=W(1),W(3)local b_,c0=bq=="any"and#ak(bp)>0,bp=="any"and#ak()>0;if bY and bn(bW,bX)then bo(bW,bX)elseif b_ or c0 then local c1,ar,an;if c0 then c1,ar,an=ak()else c1,ar,an=ak(bp)end;if aA and#c1>1 then local c2={}for a=1,#c1 do D(c2,function()bo(an[a],ar[a])end)end;b7("Select Boot File",c1,c2)else bo(an[1],ar[1])end elseif not bn(bp,bq)then aQ("Search For A Bootable Disk",0.5)for aq,M in ag()do local a7,c3=z(M)local function c4(a4)if a7.exists(a4)then aQ("Set As Bootable: "..a3(M,a4))Y(1,M)Y(3,a4)c3=1;return 1 end end;if c4("/boot/kernel/pipes")then break end;if av and c4("/OS.lua")then break else if c4("/init.lua")then break end end;local ap="/boot/kernel/"for aq,a4 in p(a7.list(ap)or{})do if c4(ap..a4)then break end end;if c3 then break end end;if bn(W(1),W(3))then goto bZ else aQ("No Bootable Medium Found",true,1)end else bo(bp,bq)end;goto bV